@model IEnumerable<Ont3010_Project_YA2024.Models.InventoryLiaison.Fridge>

@{
    ViewData["Title"] = "Fridge Index";
    Layout = ViewData["Layout"] as string;
}


<!-- Display TempData messages -->
@if (TempData["created"] != null)
{
    <div id="createdMessage" class="alert alert-success fade show" role="alert">
        @TempData["created"]
    </div>
}

@if (TempData["deleted"] != null)
{
    <div id="deletedMessage" class="alert alert-success fade show" role="alert">
        @TempData["deleted"]
    </div>
}

@if (TempData["updated"] != null)
{
    <div id="updatedMessage" class="alert alert-success fade show" role="alert">
        @TempData["updated"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div id="errorMessage" class="alert alert-danger fade show" role="alert">
        @TempData["Error"]
    </div>
}

<h1 class="text-center">
    <i class="fas fa-fridge"></i> @ViewData["Title"]
</h1>
<hr />
<div class="container mb-4">
    <div class="row">
        <div class="col-md-6">
            <p>
                <a asp-action="Create" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i> Create New Fridge
                </a>
                @* Add View Scrapped Fridges Button Next to Create Button *@
                @if (User.IsInRole("Administrator"))
                {
                    <a asp-controller="ScrappedFridge" asp-action="Index" class="btn btn-warning">
                        <i class="fas fa-eye"></i> View Scrapped Fridges
                    </a>
                }
            </p>
        </div>
        <div class="col-md-6">
            <form asp-action="Index" method="get" class="form-inline float-right">
                <div class="input-group">
                    <input type="text" name="searchString" class="form-control" placeholder="Search by Serial Number" value="@ViewData["CurrentFilter"]" />
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

</div>

<!-- Add onchange event to dropdowns -->
<div class="sort-options mb-3">
    <label for="sortOrder">Sort By:</label>
    <select id="sortOrder" onchange="updateSort()" data-current-sort="@ViewData["CurrentSort"]">
        <option value="FridgeId" selected="@(ViewData["CurrentSort"]?.ToString() == "FridgeId")">Fridge ID</option>
        <option value="SerialNumber" selected="@(ViewData["CurrentSort"]?.ToString() == "SerialNumber")">Serial Number</option>
        <!-- Add other sorting options as needed -->
    </select>

    <label for="sortDirection">Sort Direction:</label>
    <select id="sortDirection" onchange="updateSort()">
        <option value="asc" selected="@(ViewData["CurrentDirection"]?.ToString() == "asc")">Ascending</option>
        <option value="desc" selected="@(ViewData["CurrentDirection"]?.ToString() == "desc")">Descending</option>
    </select>
</div>


<table class="table table-striped table-hover">
    <thead>
        <tr>
          @*   <th>Fridge ID</th> *@
            <th>Image</th>
            <th>Model/Type</th>
            <th>SerialNumber</th>
            <th>Door Type</th>
            <th>Condition</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var fridge in Model)
        {
            <tr class="@(fridge.IsDeleted ? "is-deleted" : "")">
              @*   <td>@fridge.FridgeId</td> *@
                <td>
                    @if (fridge.FridgeImage != null)
                    {
                        <img src="data:image/png;base64,@Convert.ToBase64String(fridge.FridgeImage)" alt="Fridge Image" width="100" />
                    }
                    else
                    {
                        <span>No Image Available</span>
                    }
                </td>
                <td>@fridge.ModelType</td>
                <td>@fridge.SerialNumber</td>
                <td>@fridge.DoorType</td>
                <td>@fridge.Condition</td>
                <!-- Display conditions -->
                <td>
                    @if (fridge.IsDeleted)
                    {
                        <span class="fridge-status deleted">Deleted</span>
                    }
                    else if (fridge.IsScrapped)
                    {
                        <span class="fridge-status scrapped">Scrapped</span>
                    }
                    else if (fridge.IsAllocated)
                    {
                        <span class="fridge-status allocated">Allocated</span>
                    }
                    else if (fridge.IsInStock)
                    {
                        <span class="fridge-status in-stock">In Stock</span>
                    }
                    else
                    {
                        <span class="fridge-status out-of-stock">Out of Stock</span>
                    }
                </td>


                <td>
                    @if (fridge.IsAllocated)
                    {
                        <a asp-action="Details" asp-route-id="@fridge.FridgeId" asp-route-serialNumber="@fridge.SerialNumber" class="btn btn-success btn-sm">
                            <i class="fas fa-info-circle"></i> Details
                        </a>
                        @*  <form asp-action="Restore" method="post" class="d-inline">
                <input type="hidden" name="id" value="@fridge.FridgeId" />
                <input type="hidden" name="serialNumber" value="@fridge.SerialNumber" />

                <button type="submit" class="btn btn-warning btn-sm" onclick="return confirm('Are you sure you want to restore this Fridge?');">
                <i class="fas fa-undo"></i> Restore
                </button>
                </form> *@

                    }
                    else
                    {
                        <a asp-action="Details" asp-route-id="@fridge.FridgeId" asp-route-serialNumber="@fridge.SerialNumber" class="btn btn-success btn-sm">
                            <i class="fas fa-info-circle"></i> Details
                        </a>
                        <a asp-action="Edit" asp-route-id="@fridge.FridgeId" asp-route-serialNumber="@fridge.SerialNumber" class="btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a asp-controller="ScrappedFridge" asp-action="Create"
                           asp-route-id="@fridge.FridgeId" asp-route-serialNumber="@fridge.SerialNumber"
                           class="btn btn-danger btn-sm">
                            <i class="fas fa-plus-circle"></i> Scrap
                        </a>

                        @*   <a asp-action="Delete" asp-route-id="@fridge.FridgeId" asp-route-serialNumber="@fridge.SerialNumber" class="btn btn-danger btn-sm">
                <i class="fas fa-trash"></i> Delete
                </a> *@
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
<div class="pagination-container">
    @if (Model != null && Model.Any())
    {
        <div class="pagination">
            @if (ViewBag.CurrentPage > 1) // Check if current page is greater than 1 for Previous button
            {
                <a asp-action="Index" asp-route-page="@(ViewBag.CurrentPage - 1)" class="btn btn-secondary">Previous</a>
            }
            else
            {
                <a class="btn btn-secondary disabled">Previous</a>
                // Disabled button if on the first page
            }

            <span>Page @ViewBag.CurrentPage of @ViewBag.TotalPages</span>

            @if (ViewBag.CurrentPage < ViewBag.TotalPages) // Check if current page is less than total pages for Next button
            {
                <a asp-action="Index" asp-route-page="@(ViewBag.CurrentPage + 1)" class="btn btn-secondary">Next</a>
            }
            else
            {
                <a class="btn btn-secondary disable">Next</a>
                // Disabled button if on the last page
            }
        </div>
    }
</div>
</div>
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Function to hide TempData messages after 3 seconds
        $(document).ready(function () {
            setTimeout(function () {
                $("#createdMessage").fadeOut();
                $("#deletedMessage").fadeOut();
                $("#updatedMessage").fadeOut();
            }, 3000);
        });
    </script>
    <script>
        function updateSort() {
            const sortOrder = document.getElementById("sortOrder").value;
            const sortDirection = document.getElementById("sortDirection").value;
            const currentUrl = new URL(window.location.href);

            // Update the URL parameters
            currentUrl.searchParams.set("sortOrder", sortOrder);
            currentUrl.searchParams.set("sortDirection", sortDirection);

            // Redirect to the updated URL
            window.location.href = currentUrl.toString();
        }
    </script>

    <style>

        .Fridge-details-container {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            border-radius: .375rem;
            padding: 10px;
            margin: 10px 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .text-center {
            text-align: center;
        }



        .table th, .table td {
            text-align: center;
        }

        .table {
            width: 100%;
            margin: 0 auto;
            max-width: 1200px;
        }

            .table tbody tr.is-deleted {
                color: red; /* Indicate deleted rows */
            }

        .fa-fridge {
            color: #007bff;
        }

        .fa-plus-circle {
            color: white;
        }

        .fridge-status {
            padding: 5px 10px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            display: inline-block;
            margin-right: 5px;
        }

        /* Different status colors */
        .in-stock {
            background-color: #28a745; /* Green for In Stock */
        }

        .out-of-stock {
            background-color: #6c757d; /* Grey for Out of Stock */
        }

        .scrapped {
            background-color: #dc3545; /* Red for Scrapped */
        }

        .deleted {
            background-color: #343a40; /* Dark for Deleted */
        }

        .allocated {
            background-color: #17a2b8; /* Blue for Allocated */
        }

        .pagination-container {
            text-align: center;
            margin-top: 20px;
        }

        .btn {
            border-radius: 0.3rem;
        }

        .btn-lg {
            padding: 0.75rem 1.5rem;
        }

        .btn-sm {
            padding: 0.5rem 0.75rem;
        }
    </style>

}
